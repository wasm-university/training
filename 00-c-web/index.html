<html>
	<head>
		<meta charset="utf-8"/>
    <link rel="stylesheet" href="my.css">
	</head>
	<body>
		<h1>WASM Experiments</h1>
		<h2>ğŸ‘‹ n'oublie pas d'ouvrir la console ğŸ˜ƒ</h2>
		<script> 

      const style = 'font-size: 2em;'

			WebAssembly.instantiateStreaming(fetch("main.wasm")) 
				.then(({ instance }) => {
					console.log("%cğŸ‘‹ main.wasm is loaded", style)
					console.log("%cğŸ“¦ Instance", style, instance)
					
          const value = instance.exports.power(2, 2)

					console.log(`%cğŸ¤– value: ${value}`, style)
					console.log(`%cğŸ‘‹ greet: ${instance.exports.greet()} (location of the value)`, style) // ğŸ–ï¸ this is the location of the value

          /*
            - read the memory
            - get buffer at the position of the value
            - transform the buffer to string
          */
					
          /*
          console.log(`%c----------------------------------------------------`, style)
					const greetValue = instance.exports.greet();
					const memory = instance.exports.memory;
					const buffer = new Uint8Array(memory.buffer, greetValue, 12);
					const str = new TextDecoder("utf8").decode(buffer);
					console.log(`%cğŸ“: ${str}`, style)
          */
					
				})
				.catch(error => {
					console.log("ğŸ˜¡ ouch", error)
				})

		</script>
	</body>
</html>
